<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ganancias Uber</title>
  <style>
    body {
      background-color: #000;
      color: white;
      font-family: 'Fredoka', sans-serif;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #111;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
    }
    .menu-icon {
      cursor: pointer;
      font-size: 1.5em;
    }
    .titulo-header {
      font-weight: bold;
      font-size: 1.2em;
    }
    .modo {
      cursor: pointer;
      font-size: 0.9em;
    }
    .menu {
      position: fixed;
      top: 50px;
      left: 0;
      background-color: #222;
      width: 100%;
      display: none;
      flex-direction: column;
      z-index: 9;
    }
    .menu button {
      background: none;
      color: white;
      border: none;
      padding: 15px;
      text-align: left;
      font-size: 1em;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }
    .seccion {
      display: none;
      padding: 80px 20px 60px;
      text-align: center;
    }
    .activa {
      display: block;
    }
    input[type="text"] {
      width: 90%;
      max-width: 400px;
      padding: 10px;
      margin: 10px auto;
      font-size: 1.1em;
      border: none;
      border-radius: 5px;
      box-sizing: border-box;
    }
    .resultado {
      margin-top: 30px;
      font-size: 1.6em;
      opacity: 0;
      transition: opacity 0.5s ease-in;
    }
    .resultado.mostrar {
      opacity: 1;
    }
    .resultado span {
      color: yellow;
      font-weight: bold;
    }
    button {
      padding: 12px 30px;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      background-color: white;
      color: black;
      cursor: pointer;
      margin: 10px;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      width: 95%;
      max-width: 600px;
    }
    th, td {
      border: 1px solid white;
      padding: 8px;
    }
    th {
      background-color: #333;
    }
    footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background-color: #111;
      color: white;
      padding: 10px 0;
      font-size: 0.9em;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="menu-icon" onclick="toggleMenu()">☰</div>
    <div class="titulo-header">GANANCIAS UBER</div>
    <div class="modo" onclick="toggleModo()">MODO CLARO</div>
  </header>

  <div class="menu" id="menuDesplegable">
    <button onclick="mostrarSeccion('inicio')">CÁLCULO GANANCIA</button>
    <button onclick="mostrarSeccion('tablaMensual')">TABLA MENSUAL</button>
    <button onclick="mostrarSeccion('reportes')">REPORTES</button>
  </div>

  <div id="inicio" class="seccion activa">
    <div class="subtitulo" id="acumuladoMes">$0</div>
    <div class="mes-anterior" id="mesAnterior"></div>

    <input type="text" id="gananciaHoy" placeholder="Ganancias de hoy ($)">
    <input type="text" id="kmRecorridos" placeholder="Km recorridos">
    <input type="text" id="valorNafta" placeholder="Valor litro de nafta ($)">

    <br>
    <button onclick="calcularGanancia()">CALCULAR</button>
    <button onclick="limpiarCampos()" style="background-color: gray; color: white;">LIMPIAR CAMPOS</button>
    <button onclick="reiniciarTodo()" style="background-color: red; color: white;">REINICIAR TODO</button>

    <div class="resultado" id="resultado"></div>
  </div>

  <div id="tablaMensual" class="seccion">
    <table id="historial">
      <thead>
        <tr><th>Fecha</th><th>Km</th><th>Ganancia bruta</th><th>Ganancia neta</th></tr>
      </thead>
      <tbody id="historialBody"></tbody>
    </table>
    <button onclick="exportarCSV()">EXPORTAR A EXCEL (.CSV)</button><br>
    <button onclick="mostrarSeccion('inicio')">VOLVER A INICIO</button>
  </div>

  <div id="reportes" class="seccion">
    <table id="tablaReportes">
      <thead>
        <tr><th>Mes</th><th>Total Ganado</th></tr>
      </thead>
      <tbody id="reportesBody"></tbody>
    </table>
    <button onclick="exportarReportes()">EXPORTAR A EXCEL (.CSV)</button><br>
    <button onclick="mostrarSeccion('inicio')">VOLVER A INICIO</button>
  </div>

  <footer>Desarrollado por SDD.</footer>

  <script>
    function toggleMenu() {
      const menu = document.getElementById("menuDesplegable");
      menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
    }

    function mostrarSeccion(id) {
      document.querySelectorAll('.seccion').forEach(sec => sec.classList.remove('activa'));
      document.getElementById(id).classList.add('activa');
      if (id === 'tablaMensual') mostrarHistorial();
      if (id === 'reportes') mostrarReportes();
      document.getElementById("menuDesplegable").style.display = "none";
    }

    function toggleModo() {
      const body = document.body;
      const modo = document.querySelector('.modo');
      if (body.style.backgroundColor === "white") {
        body.style.backgroundColor = "#000";
        body.style.color = "white";
        modo.textContent = "MODO CLARO";
      } else {
        body.style.backgroundColor = "white";
        body.style.color = "black";
        modo.textContent = "MODO OSCURO";
      }
    }

    function formatearPesos(valor) {
      return valor.toLocaleString("es-AR", {
        style: "currency",
        currency: "ARS",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function calcularGanancia() {
      const gananciaHoy = parseFloat(document.getElementById("gananciaHoy").value.replace(/[^\d,.-]/g, "").replace(",", ".")) || 0;
      const km = parseFloat(document.getElementById("kmRecorridos").value.replace(/[^\d]/g, "")) || 0;
      const valorNafta = parseFloat(document.getElementById("valorNafta").value.replace(/[^\d,.-]/g, "").replace(",", ".")) || 0;

      if (!gananciaHoy || !km || !valorNafta) {
        alert("Por favor completá todos los campos con valores válidos.");
        return;
      }

      const consumoLitros = km * 0.08;
      const costoCombustible = consumoLitros * valorNafta;
      const gananciaNeta = gananciaHoy - costoCombustible;

      document.getElementById("resultado").innerHTML = `✔️ Las ganancias de hoy fueron: <span>${formatearPesos(gananciaNeta)}</span>`;
      document.getElementById("resultado").classList.add("mostrar");

      const hoy = new Date().toLocaleDateString();
      const mesActual = new Date().getFullYear() + '-' + (new Date().getMonth() + 1);

      let historial = JSON.parse(localStorage.getItem("historial") || "[]");
      historial.push({ fecha: hoy, km, bruta: gananciaHoy, neta: gananciaNeta, mes: mesActual });
      localStorage.setItem("historial", JSON.stringify(historial));

      let acumuladoMes = historial.filter(e => e.mes === mesActual).reduce((acc, el) => acc + el.neta, 0);
      document.getElementById("acumuladoMes").textContent = formatearPesos(acumuladoMes);
    }

    function mostrarHistorial() {
      const historial = JSON.parse(localStorage.getItem("historial") || "[]");
      const tbody = document.getElementById("historialBody");
      tbody.innerHTML = "";
      historial.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${item.fecha}</td><td>${item.km} km</td><td>${formatearPesos(item.bruta)}</td><td>${formatearPesos(item.neta)}</td>`;
        tbody.appendChild(tr);
      });
    }

    function mostrarReportes() {
      const historial = JSON.parse(localStorage.getItem("historial") || "[]");
      const porMes = {};
      historial.forEach(e => {
        porMes[e.mes] = (porMes[e.mes] || 0) + e.neta;
      });
      const tbody = document.getElementById("reportesBody");
      tbody.innerHTML = "";
      Object.keys(porMes).sort().forEach(mes => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${mes}</td><td>${formatearPesos(porMes[mes])}</td>`;
        tbody.appendChild(tr);
      });
    }

    function exportarCSV() {
      const historial = JSON.parse(localStorage.getItem("historial") || "[]");
      if (historial.length === 0) return alert("No hay datos para exportar.");
      let csv = "Fecha,Km,Ganancia bruta,Ganancia neta\n";
      historial.forEach(item => {
        csv += `${item.fecha},${item.km},${item.bruta},${item.neta}\n`;
      });
      descargarCSV(csv, "historial_uber.csv");
    }

    function exportarReportes() {
      const historial = JSON.parse(localStorage.getItem("historial") || "[]");
      const porMes = {};
      historial.forEach(e => {
        porMes[e.mes] = (porMes[e.mes] || 0) + e.neta;
      });
      let csv = "Mes,Total Ganado\n";
      Object.keys(porMes).sort().forEach(mes => {
        csv += `${mes},${porMes[mes]}\n`;
      });
      descargarCSV(csv, "reporte_mensual.csv");
    }

    function descargarCSV(contenido, nombre) {
      const blob = new Blob([contenido], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.setAttribute("download", nombre);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function limpiarCampos() {
      if (confirm("¿Estás seguro de que querés limpiar los campos?")) {
        document.getElementById("gananciaHoy").value = "";
        document.getElementById("kmRecorridos").value = "";
        document.getElementById("valorNafta").value = "";
        document.getElementById("resultado").textContent = "";
        document.getElementById("resultado").classList.remove("mostrar");
      }
    }

    function reiniciarTodo() {
      if (confirm("¿Estás seguro de que querés reiniciar todo?")) {
        localStorage.clear();
        location.reload();
      }
    }
  </script>
</body>
</html>